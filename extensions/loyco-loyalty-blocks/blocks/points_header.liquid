{% comment %}
  Compact header block for displaying customer loyalty points
  Designed for small header spaces with star icon + points number only
{% endcomment %}

{% assign customer_points = 0 %}
{% assign show_block = true %}

{% comment %}
  Note: Theme blocks cannot make HTTP requests directly.
  Points data will need to be injected via JavaScript or app proxy.
  For now, using placeholder data for development.
{% endcomment %}

{% comment %} Determine visibility based on settings {% endcomment %}
{% if block.settings.show_only_when_points %}
  {% if customer %}
    {% assign customer_points = 100 %}
    {% assign show_block = true %}
  {% else %}
    {% assign show_block = false %}
  {% endif %}
{% else %}
  {% if customer %}
    {% comment %} Placeholder points for logged-in customers - will be replaced by JS injection {% endcomment %}
    {% assign customer_points = 100 %}
  {% else %}
    {% if block.settings.show_when_logged_out %}
      {% assign customer_points = 0 %}
      {% assign show_block = true %}
    {% else %}
      {% assign show_block = false %}
    {% endif %}
  {% endif %}
{% endif %}

{% if show_block %}
<div class="loyco-header-points" style="
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 6px;
  background: {{ block.settings.background_color | default: '#FFF3CC' }};
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  white-space: nowrap;
  max-width: 120px;
  overflow: hidden;
  z-index: 10;
">
  {% comment %} Star icon using Unicode {% endcomment %}
  <span class="loyco-star-icon" style="
    font-size: 14px;
    color: {{ block.settings.star_color | default: '#FFD700' }};
    line-height: 1;
    display: flex;
    align-items: center;
  ">â˜…</span>

  {% comment %} Points number {% endcomment %}
  <span class="loyco-points-count" style="
    font-size: 11px;
    font-weight: 700;
    color: {{ block.settings.text_color | default: '#B8860B' }};
    min-width: 0;
  ">{{ customer_points }}</span>
</div>

{% comment %} Add hover effect and responsiveness {% endcomment %}
<style>
.loyco-header-points {
  transition: all 0.2s ease;
  cursor: pointer;
}

.loyco-header-points:hover {
  background: rgba(255, 215, 0, 0.2);
  transform: scale(1.05);
}

/* Mobile responsive */
@media (max-width: 768px) {
  .loyco-header-points {
    font-size: 11px;
    padding: 1px 4px;
    gap: 3px;
    max-width: 50px;
  }

  .loyco-star-icon {
    font-size: 12px;
  }

  .loyco-points-count {
    font-size: 10px;
  }
}

/* Ultra compact for very small headers */
@media (max-width: 480px) {
  .loyco-header-points {
    max-width: 40px;
    padding: 1px 3px;
  }
}
</style>
{% endif %}

{% schema %}
{
  "name": "Loyalty Points Header",
  "target": "section",
  "settings": [
    {
      "type": "color",
      "id": "star_color",
      "label": "Star Color",
      "default": "#FFD700"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#B8860B"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#FFF3CC"
    },
    {
      "type": "checkbox",
      "id": "show_when_logged_out",
      "label": "Show for logged-out customers",
      "info": "Display the block with 0 points for customers who are not logged in",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_only_when_points",
      "label": "Only show when customer has points",
      "info": "Hide the block if customer has 0 points (overrides 'Show for logged-out customers')",
      "default": false
    }
  ]
}
{% endschema %}
